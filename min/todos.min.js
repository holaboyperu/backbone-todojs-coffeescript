(function(){var t={}.hasOwnProperty,e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};$(function(){var t,o,i,r,s,p,u,l,h,a;return i=function(t){function n(){return u=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.defaults={content:"empty todo...",done:!1},n.prototype.initialize=function(){return this.get("content")?void 0:this.set({content:this.defaults.content})},n.prototype.toggle=function(){return this.save({done:!this.get("done")})},n.prototype.clear=function(){return this.destroy(),this.view.remove()},n}(Backbone.Model),r=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}var o;return e(n,t),n.prototype.model=i,n.prototype.localStorage=new Store("todos"),o=function(t){return t.get("done")},n.prototype.done=function(){return this.filter(o)},n.prototype.remaining=function(){return this.without.apply(this,this.done())},n.prototype.nextOrder=function(){return this.length?this.last().get("order")+1:1},n.prototype.comparator=function(t){return t.get("order")},n}(Backbone.Collection),s=function(t){function o(){return this.updateOnEnter=n(this.updateOnEnter,this),this.close=n(this.close,this),this.edit=n(this.edit,this),this.render=n(this.render,this),h=o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.tagName="li",o.prototype.template=_.template($("#item-template").html()),o.prototype.events={"click .check":"toggleDone","dblclick div.todo-content":"edit","click span.todo-destroy":"clear","keypress .todo-input":"updateOnEnter"},o.prototype.initialize=function(){return this.model.bind("change",this.render),this.model.view=this},o.prototype.render=function(){return this.$(this.el).html(this.template(this.model.toJSON())),this.setContent(),this},o.prototype.setContent=function(){var t;return t=this.model.get("content"),this.$(".todo-content").text(t),this.input=this.$(".todo-input"),this.input.bind("blur",this.close),this.input.val(t)},o.prototype.toggleDone=function(){return this.model.toggle()},o.prototype.edit=function(){return this.$(this.el).addClass("editing"),this.input.focus()},o.prototype.close=function(){return this.model.save({content:this.input.val()}),$(this.el).removeClass("editing")},o.prototype.updateOnEnter=function(t){return 13===t.keyCode?this.close():void 0},o.prototype.remove=function(){return $(this.el).remove()},o.prototype.clear=function(){return this.model.clear()},o}(Backbone.View),p=function(t){function i(){return this.addAll=n(this.addAll,this),this.addOne=n(this.addOne,this),this.render=n(this.render,this),this.initialize=n(this.initialize,this),a=i.__super__.constructor.apply(this,arguments)}var r;return e(i,t),r="#app-wrapper",i.prototype.el=$(r),i.prototype.statsTemplate=_.template($("#stats-template").html()),i.prototype.events={"keypress #input-todo":"createOnEnter","keyup #input-todo":"showTooltip","click .todo-clear a":"clearCompleted"},i.prototype.initialize=function(){return this.input=this.$("#input-todo"),o.bind("add",this.addOne),o.bind("reset",this.addAll),o.bind("all",this.render),o.fetch()},i.prototype.render=function(){return this.$("#todo-stats").html(this.statsTemplate({total:o.length,done:o.done().length,remaining:o.remaining().length}))},i.prototype.addOne=function(t){var e;return e=new s({model:t}),this.$("#todo-list").append(e.render().el)},i.prototype.addAll=function(){return o.each(this.addOne)},i.prototype.newAttributes=function(){return{content:this.input.val(),order:o.nextOrder(),done:!1}},i.prototype.createOnEnter=function(t){return 13===t.keyCode?(o.create(this.newAttributes()),this.input.val("")):void 0},i.prototype.clearCompleted=function(){return _.each(o.done(),function(t){return t.clear()}),!1},i.prototype.showTooltip=function(){var t,e,n;return e=this.$(".ui-tooltip-top"),n=this.input.val(),e.fadeOut(),this.tooltipTimeout&&clearTimeout(this.tooltipTimeout),""!==n&&n!==this.input.attr("placeholder")?(t=function(){return e.show().fadeIn()},this.tooltipTimeout=_.delay(t,1e3)):void 0},i}(Backbone.View),o=new r,t=new p})}).call(this);